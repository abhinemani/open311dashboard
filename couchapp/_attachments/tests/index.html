<!doctype html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Open311 Dashboard Tester</title>

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Open311 Dashboard</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">


  <!-- CSS: implied media="all" -->
  <link rel="stylesheet" href="css/reset.css">

  <link rel="stylesheet" href="js/libs/jquery-ui-1.8.11/css/ui-lightness/jquery-ui-1.8.11.custom.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/styles.css">

  <!-- Uncomment if you are specifically targeting less enabled mobile browsers
  <link rel="stylesheet" media="handheld" href="css/handheld.css?v=2">  -->

  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-1.7.min.js"></script>

</head>

<body>

  <div id="container">
    <div id="dashboard">	  
      <div class="input-widgets">
      <div id="header"><h1>Open311 Dashboard // SF</h1></div>
      <div id="search" class="open311-global-input"></div>
      
	 <div id="updated"> <h2 id="last-updated">Loading...</h2></div>

	<div class="ui-widget open-vs-closed-bar"></div>
	
	 <div class="ui-widget open-vs-closed pie"></div> <!-- pie -->
      <div class="ui-widget sidewalk-proportion pie"></div>
      <div class="ui-widget sidewalk-open-closed pie"></div>
      <div class="ui-widget neighborhood-proportion pie"></div>
      </div>
     
     
      
      
      
      
      <div>
		  <div id="grid">
            <div id="left-two">
                <div class="ui-widget sparkline">
                 <h2 class="ui-widget-header">Sidewalk Cleanings by Month</h2>
                     <div class="ui-widget-content"><img src="images/sparkline.png"></div>
                     </div>
      		  <div class="column-1">
                  <div class="ui-widget">
                         <h2 class="ui-widget-header">Top Ten Request Types</h2>
                             <div class="ui-widget-content"><img src="http://chart.apis.google.com/chart?chxs=0,676767,11.5,0,l,FFFFFF|1,FFFFFF,11.5,0,_,FFFFFF&chxt=y,x&chbh=a&chs=225x200&cht=bhs&chco=1d8dc3&chds=0,100&chxr=0,0,100&chd=t:33.452794265875234,9.046365774442828,7.836823832456043,4.566580804121402,4.191398812856983,3.701422331728077,2.063500951954306,2.0551013551349535,1.965505655728525,1.9263075372382126&chxl=0:|Damaged_Tree|Cans_Left_Out_24x7|SFHA%20-%20Emergency%20-%20Priority|Graffiti|Street_Cleaning|Pavement_Defect|SFHA%20-%20Urgent%20-%20Priority|Abandoned%20Vehicle|Illegal_Dumping|Sidewalk_Cleaning&chm=t+688,676767,0,9,11|t+702,676767,0,8,11|t+734,676767,0,7,11|t+737,676767,0,6,11|t+1322,676767,0,5,11|t+1497,676767,0,4,11|t+1631,676767,0,3,11|t+2799,676767,0,2,11|t+3231,676767,0,1,11|t+11948,676767,0,0,11"></div>
                             </div>      		  </div>
      		  <div class="column-2">
                   <div class="ui-widget">
                       <h2 class="ui-widget-header">Sidewalk Requests by Neighborhood</h2>
                           <div class="ui-widget-content"><img src="http://chart.apis.google.com/chart?chxs=0,676767,11.5,0,l,FFFFFF|1,FFFFFF,11.5,0,_,FFFFFF&cht=bhs&chxt=y,x&chbh=a&chs=225x200&chco=1d8dc3&chds=0,600&chxr=0,0,400&chd=t:440,141,90,82,71,53,42,42,40,32&chxl=0:|Visitacion%20Valley|Ocean%20View|Inner%20Richmond|Bernal%20Heights|Castro/Upper%20Market|Bayview|Excelsior|Western%20Addition|Mission|South%20of%20Market&chm=t+32,676767,0,9,11|t+40,676767,0,8,11|t+42,676767,0,7,11|t+42,676767,0,6,11|t+53,676767,0,5,11|t+71,676767,0,4,11|t+82,676767,0,3,11|t+90,676767,0,2,11|t+141,676767,0,1,11|t+440,676767,0,0,11"></div>
                           </div>
      		     <!-- <div class="ui-widget top-open-requests"></div>-->
      	      </div>
            </div>
      		  <div class="column-3">
                  <div class="ui-widget map">
                         <h2 class="ui-widget-header">Clusters of Requests in San Francisco</h2>
                             <div class="ui-widget-content" style="height: 365px;"><img src="images/map.png" width="475px" height="365px"></div>
                             </div>                </div>
		</div><!-- end widget-container -->
         <div style="clear:both"></div>
          <p align="center">
        <a href="http://codeforamerica.org/?cfa_project=open311-dashboard">  <img src="http://codeforamerica.org/logo-small.png" tite="code for america" width="200px" align="center" vspace="10px" style="margin-bottom: 10px;"></a>
          </p>		</div>
  
  </div> <!--! end of #container -->


  <!-- JavaScript at the bottom for fast page loading -->
  <script src="js/libs/jquery-ui-1.8.11/js/jquery-1.5.1.min.js"></script>
  <script>
  //Display last update date
  $(document).ready(function(){
      $.ajax({
	      //url: 'http://open311.couchone.com/service-requests/_design/requests/_view/open_byday_ordered_ms?group=true',
	      //url: 'http://open311.couchone.com/service-requests/_design/requests/_view/open_byday_ordered_ms?group=true',
	      url: 'http://ec2-50-17-130-61.compute-1.amazonaws.com:5984/service-requests/_design/requests/_view/open_byday_ordered_ms?group=true',
	      //cache: true,
	      dataType: 'jsonp',
	      success: function(data){
			  insert_update(data);
		       }
    });  
    
    function insert_update(data){
      //var last_date = new Date(data.rows[data.rows.length-1].key); //dates in ms
      var last_date = new Date(data.rows[data.rows.length-1].key);
      var day = last_date.getDate();
      var year = last_date.getFullYear();
      var month_array = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      var month = month_array[last_date.getMonth()];
      var formatted_last_date = month + ' ' + day + ', ' + year;
      $('#last-updated').html("<b>Last updated on " + formatted_last_date + "</b>");
    }  
  });
  </script>

  <!-- Libraries -->
  <script src="js/libs/jquery-ui-1.8.11/js/jquery-ui-1.8.11.custom.min.js"></script>
  <script src="js/libs/raphael.js"></script>

  <!-- widget bases -->
  <script src="../widgets/js/open311.widget.base.js"></script>
  <script src="../widgets/js/open311.widget.base-global-input.js"></script>
  <script src="../widgets/js/open311.widget.base-barchart-raphael.js"></script>
  <script src="../widgets/js/open311.widget.base-neighborhoods-sc-trends.js"></script>  
  <script src="../widgets/js/open311.widget.base-barchart-google.js"></script>
  <script src="../widgets/js/open311.widget.base-pie-raphael.js"></script>  
  <script src="../widgets/js/open311.widget.base-map-google.js"></script> 
  
    
  
  <!-- others -->
  <script src="../widgets/js/open311.widget.global-search.js"></script>
  <script src="../widgets/js/open311.widget.barchart-raphael-open-closed.js"></script>
  <script src="../widgets/js/open311.widget.barchart-google-top-open-requests_2011.js"></script>
  <script src="../widgets/js/open311.widget.pie-raphael-open-closed_2011.js"></script>
  <script src="../widgets/js/open311.widget.pie-raphael-sidewalk_prop.js"></script>
  <script src="../widgets/js/open311.widget.pie-raphael-neighborhood.js"></script>
  <script src="../widgets/js/open311.widget.pie-raphael-sidewalk_open-closed.js"></script>
  
  <!-- <script src="../widgets/js/open311.widget.neighborhoods-sc-trends.js"></script>
  <script src="../widgets/js/open311.widget.example-map-google.js"></script> -->

  
  <!-- create widgets -->
  <script src="js/new_widget-tester.js"></script>
  <!-- end scripts-->

  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix("img, .png_bg"); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->

</body>
</html>
